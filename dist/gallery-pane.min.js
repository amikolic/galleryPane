!function(a){"function"==typeof define&&define.amd?define(["jquery","swipejs","./scroll-slider"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery"),require("swipejs"),require("./scroll-slider")):window.GalleryPane=a(window.jQuery,window.Swipe)}(function(a,b){function c(a){return"."+a.replace(/\s/g,".")}function d(b,c){var d="";return a.each(b,function(a,b){d+=c(b,a)}),d}function e(){this.initialize.apply(this,arguments)}var f=0,g=a(window),h=a(window.document);return e.defaults={elementClassName:"gpElement",headerClassName:"gpHeader",closeBtnClassName:"gpCloseBtn",pagesClassName:"gpPages",brandingClassName:"gpBrand",brandingUrl:null,itemsWrapClassName:"gpItems",itemClassName:"gpItem",videoItemClassName:"gpVideoItem",htmlItemClassName:"gpHtmlItem",itemImageClassName:"gpItemImage",toggleThumbsBtnClassName:"gpToggleThumbsBtn",thumbsWrapClassName:"gpThumbs",thumbsScrollerClassName:"gpThumbsScroller",thumbClassName:"gpThumb",thumbsOpenedClassName:"gpThumbsActive",thumbActiveClassName:"gpThumbActive",arrowsClassName:"gpArrows",arrowNextClassName:"gpArrow gpArrowNext",arrowPrevClassName:"gpArrow gpArrowPrev",arrowDisabledClassName:"gpArrowDisabled",socialLinksClassName:"gpSocial",toggleSocialLinksBtnClassName:"gpToggleSocialBtn",toggleSocialLinksWrapClassName:"gpWrapSocialLinks",socialLinksOpenedClassName:"gpSocialActive",hasSocialLinksClassName:"gpHasSocialLinks",infoToggleClassName:"gpInfoToggle",infoToggleButtonText:"Show image info",infoOpenedClassName:"gpInfoActive",brandingText:"Gallery pane",toggleThumbsBtnText:"Toggle thumbs",toggleSocialLinksBtnText:"Toggle social links",closeBtnText:"Close gallery",sourceLabelText:"Source",authorLabelText:"Author",appendTarget:"body",items:[],thumbsLength:0,position:0,continuous:!1,slideSpeed:300,navigateWithKeys:!0,closeOnEscapeKey:!0,updateUrl:!0,toggleSocialLinks:!1,shouldShowAdvertising:function(a){return!1},advertisingTemplate:function(){},whenAdvertisingElementReady:function(a){},advertisingCloseText:"Skip advertising",advertisingCloseClassName:"gpAdvertisingClose",afterRender:null,afterPositionChange:null,scrollSlider:{arrowWrapClass:"gpScrollSliderArrows",arrowNextClass:"gpScrollSliderArrowNext",arrowPrevClass:"gpScrollSliderArrowPrev",arrowDisabledClass:"gpScrollSliderArrowDisabled",hasArrowsClass:"gpScrollSliderHasArrows",touchClass:"gpScrollSliderTouch"}},a.extend(e.prototype,{initialize:function(b){this.options=a.extend(!0,{},e.defaults,b),this.position=this.options.position,this.ens=".GalleryPane"+ ++f,this.positionChangeCounter=0,this.advertisingActive=!1,this.options.thumbsLength=this.options.items.length,this.options.items.filter(function(a,b){"undefined"==typeof a.smallImage&&this.options.thumbsLength--}.bind(this)),this.render(),this.loadImage(this.position,!0),this.setupEvents(),this.options.updateUrl&&this.updateUrl({url:this.options.items[this.position].url,title:this.options.items[this.position].title})},render:function(){this.$el=a(this.templates.main(this.options)),this.options.items.length>1&&(this.$arrowsCont=a(this.templates.arrows(this.options)).appendTo(this.$el),this.$arrowNext=this.$arrowsCont.find(c(this.options.arrowNextClassName)),this.$arrowPrev=this.$arrowsCont.find(c(this.options.arrowPrevClassName))),this.$swipeEl=this.$el.find(c(this.options.itemsWrapClassName)),this.$itemImages=this.$el.find(c(this.options.itemImageClassName)),this.$pagination=this.$el.find(c(this.options.pagesClassName)),this.$socialLinks=a("<div>").addClass(this.options.socialLinksClassName).appendTo(this.$el),this.$el.appendTo(this.options.appendTarget),this.swipe=new b(this.$swipeEl.get(0),{startSlide:this.position,speed:this.options.slideSpeed,continuous:this.options.continuous,callback:function(a,b){this.setPosition(a)}.bind(this)}),this.updateDom().callbackOnShow(this.options.items[this.position]),this.options.afterRender&&this.options.afterRender(this)},setEvent:function(b,d,e,f){var g=this.ens,h=d.replace(/\w\b/g,function(a){return a+g});return b.on(h,e&&c(this.options[e]),a.proxy(f,this)),this},setupEvents:function(){this.setEvent(this.$el,"click","toggleThumbsBtnClassName",this.toggleThumbnails),this.setEvent(this.$el,"click","arrowNextClassName",this.next),this.setEvent(this.$el,"click","arrowPrevClassName",this.prev),this.setEvent(this.$el,"click","closeBtnClassName",this.close),this.setEvent(this.$el,"click","infoToggleClassName",this.toggleInfo),this.setEvent(this.$el,"click","thumbClassName",function(b){this.setPosition(a(b.currentTarget).data("index"))}),this.setEvent(h,"keyup",null,function(a){this.options.closeOnEscapeKey&&27===a.keyCode&&this.close(),this.options.navigateWithKeys&&this.options.items.length>1&&((39===a.keyCode||68===a.keyCode)&&this.next(),(37===a.keyCode||65===a.keyCode)&&this.prev())}),this.options.toggleSocialLinks&&this.setEvent(this.$el,"click","toggleSocialLinksBtnClassName",this.toggleSocialLinks),this.options.updateUrl&&this.setEvent(g,"popstate",null,this.close)},normalizePosition:function(a){return a>=this.options.items.length?this.options.continuous?0:this.position:a<0?this.options.continuous?this.options.items.length-1:this.position:a},loadImage:function(a,b){var c=this,d=new Image,e=this.normalizePosition(a),f=this.options.items[e].largeImage;return f&&(this.$itemImages.filter('[data-index="'+e+'"]').attr("src",f),b&&(d.onload=function(){c.loadImage(a+1).loadImage(a-1)}),d.src=f),this},setPosition:function(b){var c=this.normalizePosition(b),d=this.options.items[c];c!==this.position&&(this.advertisingActive?this.removeAdvertising():(this.positionChangeCounter++,this.options.shouldShowAdvertising(this.positionChangeCounter)?(this.$advertisingElement=a('<div class="'+this.options.elementClassName+'Advertising" />').appendTo(this.$el),this.$bannerElement=a(this.options.advertisingTemplate(this)).appendTo(this.$advertisingElement),a('<button class="'+this.options.advertisingCloseClassName+'">'+this.options.advertisingCloseText+"</button>").prependTo(this.$advertisingElement).on("click",function(){this.removeAdvertising()}.bind(this)),this.advertisingActive=!0,this.$el.addClass("advertisingActive"),this.options.whenAdvertisingElementReady(this.$bannerElement,this)):this.$advertisingElement&&this.removeAdvertising(),this.position=c,this.swipe.slide(c),this.updateDom(),this.loadImage(c,!0),this.options.updateUrl&&this.updateUrl({url:d.url,title:d.title}),this.options.afterPositionChange&&this.options.afterPositionChange(this),this.callbackOnShow(d)))},removeAdvertising:function(){this.advertisingActive=!1,this.$advertisingElement.remove(),this.$el.removeClass("advertisingActive")},callbackOnShow:function(a){"undefined"!=typeof a.onFirstShowCallback&&(a.onFirstShowCallback(this),delete a.onFirstShowCallback),a.onShowCallback&&a.onShowCallback(this)},updateUrl:function(a){this.startHistoryState?history.replaceState({},a.title,a.url):(this.startHistoryState={url:window.location.href,title:document.title},history.pushState({},a.title,a.url)),a.title&&(document.title=a.title)},updateDom:function(){var a=this.options,b=a.items[this.position],c=this.position+1;return this.thumbsSlider&&(this.thumbsSlider.scrollTo(this.position),this.$thumbs.removeClass(this.options.thumbActiveClassName).filter('[data-index="'+this.position+'"]').addClass(a.thumbActiveClassName)),!this.options.continuous&&this.$arrowsCont&&(this.$arrowNext.toggleClass(this.options.arrowDisabledClassName,this.position===this.options.items.length-1),this.$arrowPrev.toggleClass(this.options.arrowDisabledClassName,0===this.position)),"undefined"!=typeof b.smallImage&&(this.options.items.filter(function(a,b){b<this.position&&"undefined"==typeof a.smallImage&&c--}.bind(this)),this.$pagination.text(c+"/"+a.thumbsLength)),b.socialLinks&&b.socialLinks.length>0?(this.$el.addClass(a.hasSocialLinksClassName),this.$socialLinks.html(this.templates.socialLinks(b.socialLinks,this.options))):this.$el.removeClass(a.hasSocialLinksClassName),this},next:function(){this.setPosition(this.position+1)},prev:function(){this.setPosition(this.position-1)},toggleSocialLinks:function(){this.$el.toggleClass(this.options.socialLinksOpenedClassName)},toggleInfo:function(){this.$el.toggleClass(this.options.infoOpenedClassName)},toggleThumbnails:function(){this.$el.hasClass(this.options.thumbsOpenedClassName)?this.hideThumbNails():this.showThumbnails()},showThumbnails:function(){this.$el.addClass(this.options.thumbsOpenedClassName),this.thumbsSlider||(this.thumbsSlider=new a.ScrollSlider(a(this.templates.thumbs(this.options)).appendTo(this.$el),this.options.scrollSlider),this.$thumbs=this.thumbsSlider.$el.find(c(this.options.thumbClassName)),"undefined"!=typeof this.options.items[this.position].smallImage&&this.$thumbs.filter('[data-index="'+this.position+'"]').addClass(this.options.thumbActiveClassName)),this.thumbsSlider.scrollTo(this.position)},hideThumbNails:function(){this.$el.removeClass(this.options.thumbsOpenedClassName)},close:function(){this.options.updateUrl&&this.startHistoryState&&this.updateUrl(this.startHistoryState),g.off(this.ens),h.off(this.ens),this.swipe.kill(),this.scrollSlider&&this.scrollSlider.destroy(),this.$el.remove()},templates:{main:function(a){var b=this;return'<div class="'+a.elementClassName+'"><div class="'+a.headerClassName+'">'+(null!==a.brandingUrl?'<a href="'+a.brandingUrl+'" class="'+a.brandingClassName+'">'+a.brandingText+"</a>":'<div class="'+a.brandingClassName+'">'+a.brandingText+"</div>")+'<p class="'+a.pagesClassName+'"></p><button type="button" title="'+a.toggleThumbsBtnText+'" class="'+a.toggleThumbsBtnClassName+'">'+a.toggleThumbsBtnText+'</button><button type="button" title="'+a.closeBtnText+'" class="'+a.closeBtnClassName+'">'+a.closeBtnText+'</button></div><div class="'+a.itemsWrapClassName+'"><ul>'+d(a.items,function(c,d){return b.slideItem(a,c,d)})+'</ul></div><a class="'+a.infoToggleClassName+'">'+a.infoToggleButtonText+"</a></div>"},slideItem:function(a,b,c){return b.videoUrl?'<li><div class="'+a.itemClassName+'"><div class="'+a.videoItemClassName+'"><iframe frameborder="0" allowfullscreen src="'+b.videoUrl+'"></iframe></div></div></li>':b.html?'<li><div class="'+a.itemClassName+'"><div class="'+a.htmlItemClassName+'">'+b.html+"</div></div></li>":'<li><div class="'+a.itemClassName+'"><img class="'+a.itemImageClassName+'" data-index="'+c+'" data-src="'+b.largeImage+'" alt="'+b.title+'" /></div><div class="gpInfoWrap"><strong class="gpCaption">'+b.title+"</strong>"+(b.source||b.author?'<strong class="gpCopy">'+(b.source?a.sourceLabelText+": "+b.source:"")+(b.source&&b.author?" / ":"")+(b.author?a.authorLabelText+": "+b.author:"")+"</strong>":"")+"</div></li>"},thumbs:function(a){return'<div class="'+a.thumbsWrapClassName+'"><div class="'+a.thumbsScrollerClassName+'"><ul>'+d(a.items,function(b,c){return"undefined"!=typeof b.smallImage?'<li><div class="'+a.thumbClassName+'" data-index="'+c+'"><img src="'+b.smallImage+'" alt="'+b.title+'" /></div></li>':""})+"</ul></div></div>"},arrows:function(a){return'<div class="'+a.arrowsClassName+'"><button type="button" class="'+a.arrowNextClassName+'"></button><button type="button" class="'+a.arrowPrevClassName+'"></button></div>'},socialLinks:function(a,b){var c=d(a,function(a){return'<a href="'+a.url+'" class="'+a.className+'" title="'+a.title+'">'+a.title+"</a>"});return b.toggleSocialLinks?'<button type="button" class="'+b.toggleSocialLinksBtnClassName+'">'+b.toggleSocialLinksBtnText+'</button><div class="'+b.toggleSocialLinksWrapClassName+'">'+c+"<div>":c}}}),e});